need to make the error handling a bit neater, maybe in an utils subroutine.
